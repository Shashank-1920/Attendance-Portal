<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>University Faculty Dashboard</title>
  <!-- SheetJS (XLSX parser) CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --bg:#f5f7fa; --card:#ffffff; --muted:#6b7280; --accent:#1d4ed8; --gold:#f59e0b;
      --rounded:16px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#0f172a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);padding:28px}
    .container{max-width:1200px;margin:0 auto}
    .card{background:var(--card);border-radius:var(--rounded);padding:20px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    .profile{display:flex;gap:22px;align-items:center}
    .avatar{width:96px;height:96px;border-radius:50%;border:6px solid #e6eefb;display:flex;align-items:center;justify-content:center;background:#f3f4f6;font-size:36px}
    h1{margin:0;font-size:28px;font-weight:700}
    .sub{color:var(--accent);margin-top:6px}
    .badge{display:inline-block;background:var(--gold);color:#111;padding:6px 12px;border-radius:999px;margin-top:10px;font-weight:600}
    .grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-top:18px}
    .stat{display:flex;gap:12px;align-items:center;padding:14px;border-radius:12px;background:#fff}
    .stat .icon{width:48px;height:48px;border-radius:10px;background:#f3f6ff;display:flex;align-items:center;justify-content:center;font-size:22px}
    .stat .val{font-weight:700;font-size:20px}
    .tabs{display:flex;align-items:center;gap:12px;padding:16px;border-radius:14px;margin-top:18px;background:transparent}
    .tabs button{padding:8px 18px;border-radius:999px;border:0;background:transparent;cursor:pointer}
    .tabs .active{background:#f3f4f6}
    .top-right{margin-left:auto;display:flex;align-items:center;gap:10px}
    input.search{padding:10px 14px;border-radius:10px;border:1px solid #e6e9ef;min-width:220px}
    .table-wrap{margin-top:18px;border-radius:12px;overflow:hidden;border:1px solid #edf2f7;background:#fff}
    table{width:100%;border-collapse:collapse}
    thead th{padding:14px;text-align:left;background:#fbfdff;color:#475569;border-bottom:1px solid #f1f5f9}
    tbody td{padding:14px;border-bottom:1px solid #f8fafc;vertical-align:middle}
    tbody tr:nth-child(even){background:#fff}
    .dept-badge{display:inline-block;background:var(--gold);padding:6px 10px;border-radius:999px;font-weight:600}
    .action-btn{padding:8px 12px;border-radius:10px;border:1px solid #e6e9ef;background:#fff;cursor:pointer}
    .leaves-b{display:inline-block;padding:6px 10px;border-radius:999px;color:#fff;font-weight:700}
    .leaves-blue{background:#2b8cf5}
    .leaves-red{background:#ef4444}
    .modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:flex;align-items:center;justify-content:center;z-index:60}
    .modal{width:90%;max-width:900px;background:#fff;border-radius:12px;padding:20px;box-shadow:0 20px 40px rgba(2,6,23,0.2)}
    .modal .close{border:0;background:transparent;font-size:18px;cursor:pointer}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:980px){.grid4{grid-template-columns:repeat(2,1fr)}.two-col{grid-template-columns:1fr}.tabs{flex-wrap:wrap}}
    @media (max-width:640px){.grid4{grid-template-columns:1fr}input.search{min-width:140px}.profile{flex-direction:column;align-items:flex-start;gap:10px}}
    .muted{color:var(--muted);font-size:13px}
    .link-like{color:var(--accent);text-decoration:underline;cursor:pointer}
  </style>
</head>
<body>
  <div class="container">
    <!-- PROFILE CARD -->
    <div class="card profile">
      <div class="avatar">üë§</div>
      <div style="flex:1">
        <h1>Dr. Rajesh Kumar</h1>
        <div class="sub">Head of Department - Computer Science</div>
        <div class="badge">EMP001</div>
      </div>
    </div>

    <!-- STAT CARDS -->
    <div class="grid4">
      <div class="stat card"><div class="icon">üè¢</div><div><div class="muted">Departments</div><div class="val">4</div></div></div>
      <div class="stat card"><div class="icon">üë•</div><div><div class="muted">Total Staff</div><div id="stat-total" class="val">0</div></div></div>
      <div class="stat card"><div class="icon">üìÖ</div><div><div class="muted">Leaves Taken</div><div id="stat-leaves" class="val">0</div></div></div>
      <div class="stat card"><div class="icon">‚è∞</div><div><div class="muted">Current Time</div><div id="stat-time" class="val">--:--:--</div></div></div>
    </div>

    <!-- TABS -->
    <div class="card" style="margin-top:18px">
      <div style="display:flex;align-items:center">
        <div class="tabs" role="tablist">
          <button id="tab-manage" class="active">Manage Staff</button>
          <button id="tab-work">Work Details</button>
          <button id="tab-pub">Publications</button>
          <button id="tab-research">Research</button>
        </div>

        <div class="top-right">
          <input id="search" class="search" placeholder="Search staff..." />
          <label style="display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:#f8fafc;border:1px solid #eef2ff;cursor:pointer">
            <input id="excelFile" type="file" accept=".xlsx, .xls" style="display:none"/>
            Upload Excel
          </label>
        </div>
      </div>

      <div id="tabContent" style="margin-top:18px">
        <div id="manageTab">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Employee ID</th>
                  <th>Name</th>
                  <th>Department</th>
                  <th>Designation</th>
                  <th>Contact</th>
                  <th>Leaves</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="staffBody"></tbody>
            </table>
          </div>
        </div>
        <div id="placeholderTab" style="display:none;padding:18px;color:#374151">
          This tab is a placeholder. Replace with real content (work details, publications, or research panels).
        </div>
      </div>
    </div>

    <div id="modalRoot" style="display:none"></div>
  </div>

<script>
let staff = [];
const staffBody = document.getElementById('staffBody');
const statTotal = document.getElementById('stat-total');
const statLeaves = document.getElementById('stat-leaves');
const statTime = document.getElementById('stat-time');
const searchInput = document.getElementById('search');
const excelFileInput = document.getElementById('excelFile');
const modalRoot = document.getElementById('modalRoot');

function renderStats(){
  statTotal.textContent = staff.length;
  const totalLeaves = staff.reduce((a,b)=>a+(Number(b.leaves)||0),0);
  statLeaves.textContent = totalLeaves;
}
function renderLeaves(n){
  const val = Number(n)||0;
  const cls = val > 7 ? 'leaves-red' : 'leaves-blue';
  return `<div class="leaves-b ${cls}">${val} days</div>`;
}
function escapeHtml(t){return String(t||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));}
function formatRow(r){
  return `<tr>
    <td>${escapeHtml(r.employeeId||'')}</td>
    <td style="display:flex;align-items:center;gap:12px">
      <div style="width:36px;height:36px;border-radius:50%;background:#f3f4f6;display:flex;align-items:center;justify-content:center">üë§</div>
      <div>${escapeHtml(r.name||'')}</div>
    </td>
    <td><span class="dept-badge">${escapeHtml(r.department||'')}</span></td>
    <td>${escapeHtml(r.designation||'')}</td>
    <td>
      <div class="link-like">${escapeHtml(r.workEmail||'')}</div>
      <div class="muted">${escapeHtml(r.phone||'')}</div>
    </td>
    <td>${renderLeaves(r.leaves)}</td>
    <td><button class="action-btn" data-id="${escapeHtml(r.employeeId||'')}" onclick="viewDetails(event)">View</button></td>
  </tr>`;
}
function renderTable(filter=''){
  const q = filter.toLowerCase();
  const rows = staff.filter(s=>Object.values(s).join(' ').toLowerCase().includes(q));
  staffBody.innerHTML = rows.map(formatRow).join('') || '<tr><td colspan="7" style="text-align:center;padding:18px;color:#6b7280">No data</td></tr>';
  renderStats();
}

/* Excel Upload */
excelFileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    const data = new Uint8Array(ev.target.result);
    const workbook = XLSX.read(data, {type:'array'});
    const sheetName = workbook.SheetNames[0];
    const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
    staff = sheet.map((r,i)=>({
      employeeId: r.employeeId || r.EmployeeID || r.ID || `XLSX${i+1}`,
      name: r.name || r.Name || '',
      department: r.department || r.Department || '',
      designation: r.designation || r.Designation || '',
      workEmail: r.workEmail || r.WorkEmail || r.Email || '',
      phone: r.phone || r.Phone || '',
      leaves: r.leaves || r.Leaves || 0
    }));
    renderTable();
    alert(`Loaded ${staff.length} records from ${sheetName}`);
  };
  reader.readAsArrayBuffer(file);
});

/* Modal */
function viewDetails(e){
  const id = e.currentTarget.dataset.id;
  const rec = staff.find(s=>s.employeeId===id);
  if(!rec) return;
  openModal(rec);
}
function openModal(rec){
  modalRoot.style.display='block';
  modalRoot.innerHTML=`<div class="modal-back" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>${escapeHtml(rec.name)}</h2>
        <button class="close" onclick="closeModal(event)">‚úñ</button>
      </div>
      <div class="two-col" style="margin-top:10px">
        <div>
          <div class="muted">Employee ID</div><div>${escapeHtml(rec.employeeId)}</div>
          <div class="muted">Department</div><div>${escapeHtml(rec.department)}</div>
          <div class="muted">Designation</div><div>${escapeHtml(rec.designation)}</div>
        </div>
        <div>
          <div class="muted">Work Email</div><div>${escapeHtml(rec.workEmail)}</div>
          <div class="muted">Phone</div><div>${escapeHtml(rec.phone)}</div>
          <div class="muted">Leaves</div><div>${escapeHtml(rec.leaves)}</div>
        </div>
      </div>
      <div style="display:flex;justify-content:end;margin-top:16px">
        <button class="action-btn" onclick="closeModal(event)">Close</button>
      </div>
    </div>
  </div>`;
}
function closeModal(e){e.stopPropagation();modalRoot.style.display='none';modalRoot.innerHTML='';}
window.closeModal=closeModal;

/* Tabs + Search + Clock */
document.getElementById('tab-manage').onclick=()=>setTab('manage');
document.getElementById('tab-work').onclick=()=>setTab('work');
document.getElementById('tab-pub').onclick=()=>setTab('pub');
document.getElementById('tab-research').onclick=()=>setTab('research');
function setTab(t){
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+t).classList.add('active');
  document.getElementById('manageTab').style.display=(t==='manage'?'block':'none');
  document.getElementById('placeholderTab').style.display=(t==='manage'?'none':'block');
}
searchInput.oninput=()=>renderTable(searchInput.value);
function tick(){statTime.textContent=new Date().toLocaleTimeString();}
setInterval(tick,1000);tick();
</script>
</body>
</html>
